---
title: "[Infosec] Cross-Site Request Forgery(CSRF) 완전 정리"
date: 2025-09-10 20:15:00 +0900
categories: [보안, Web]   # 카테고리는 여러 계층도 가능 [상위, 하위]
tags: [웹해킹, CSRF]          # 해시태그처럼 글 묶기
description: "인증정보로 요청을 위조하기"
author: "송지민"
toc: true
---

# 사용자를 속여 서버에 위조 요청을 보내는 공격
---

> 이 글은 **보안 학습/방어 목적**입니다. 실습은 **본인 로컬/테스트 환경**에서만 하세요.

## CSRF란?

**CSRF(Cross-Site Request Forgery)** 는 임의 사용자가 로그인된 상태에서,  
공격자가 의도한 **HTTP 요청을 해당 사용자의 권한으로 서버에 보내게 만드는 취약점**이다.

즉, 사용자가 공격자가 만든 페이지에 접속했을 때 브라우저가 자동으로 **쿠키/세션을 붙여 요청**하기 때문에 발생한다.

---

## 예제 코드 (취약한 서버)

```python
# /sendmoney 경로에 접근하면 송금 기능을 수행
@app.route('/sendmoney')
def sendmoney(name):
    # 송금 대상과 금액 입력
    to_user = request.args.get('to')
    amount = int(request.args.get('amount'))
    
    # 송금 기능 실행 후 결과 반환
    success_status = send_money(to_user, amount)
    
    if success_status:
        return "Send success."
    else:
        return "Send fail."
```

위 코드는 OTP나 결제 비밀번호 같은 **추가 인증 과정이 없고**,  
단순히 `쿠키 세션 + 수신자 + 금액`만 있으면 송금이 실행되므로 CSRF 공격에 취약하다.

---

## CSRF 공격 예시

### 1) HTML 태그를 이용한 공격
```html
<img src="https://bank.example/sendmoney?to=hacker&amount=1337" width="0" height="0">
```

### 2) JavaScript를 이용한 공격
```html
<script>
// 새 창 열기
window.open("https://bank.example/sendmoney?to=hacker&amount=1337");
// 현재 창 주소 변경
location.href = "https://bank.example/sendmoney?to=hacker&amount=1337";
location.replace("https://bank.example/sendmoney?to=hacker&amount=1337");
</script>
```

> `.example` 도메인은 문서/예시에 쓰라고 예약된 안전한 도메인입니다.

---

## 방어 기법

1. **CSRF 토큰 사용**  
   - 요청마다 난수 토큰을 발급하고 서버에서 검증  
   - 토큰이 없거나 틀리면 요청 거부

2. **SameSite 쿠키**  
   - `SameSite=Lax` 또는 `Strict` 설정으로, 크로스 도메인 요청 시 쿠키를 자동 전송하지 않음

3. **추가 인증 수단**  
   - 송금, 결제 등 민감한 기능에는 **OTP/비밀번호 재입력** 요구

4. **Referer/Origin 검증**  
   - 요청 헤더의 `Origin`이나 `Referer`를 확인하여 허용된 도메인만 수락

---

## XSS와 비교

### 공통점
- 둘 다 **클라이언트를 유인**하여 악성 페이지에 접속시켜야 한다.

### 차이점
- **XSS**: 공격 스크립트가 **피해 사이트의 Origin**에서 실행 → 쿠키/세션 탈취, DOM 조작, 피싱 등 가능  
- **CSRF**: 피해자가 로그인한 상태를 이용 → **서버에 임의 요청**을 보내 기능 수행 (송금, 비밀번호 변경 등)  

👉 정리하면,  
- **XSS**는 **브라우저 안에서 코드 실행**을 통해 **인증정보 탈취**  
- **CSRF**는 **서버에 요청 위조**를 통해 **인증정보 가진 사용자의 권한을 남용**
